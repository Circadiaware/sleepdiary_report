(function(){var H="function"==typeof Object.defineProperties?Object.defineProperty:function(d,m,p){if(d==Array.prototype||d==Object.prototype)return d;d[m]=p.value;return d};function I(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var m=0;m<d.length;++m){var p=d[m];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");}var J=I(this);
function K(d,m){if(m)a:{var p=J;d=d.split(".");for(var q=0;q<d.length-1;q++){var u=d[q];if(!(u in p))break a;p=p[u]}d=d[d.length-1];q=p[d];m=m(q);m!=q&&null!=m&&H(p,d,{configurable:!0,writable:!0,value:m})}}K("Array.prototype.find",function(d){return d?d:function(m,p){a:{var q=this;q instanceof String&&(q=String(q));for(var u=q.length,w=0;w<u;w++){var z=q[w];if(m.call(p,z,w,q)){m=z;break a}}m=void 0}return m}});/*

 Sleep Diary Report - summary of a sleep diary for use by doctors
 Copyright (C) 2021 Sleepdiary Developers <sleepdiary@pileofstuff.org>

 This program is free software; you can redistribute it and/or
 modify it under the terms of the GNU General Public License
 as published by the Free Software Foundation; version 2
 of the License.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
*/
("undefined"!==typeof module&&module.exports?module.exports={}:self).sleepdiary_report=function(d){function m(b){return 9<b?b:"0"+b}function p(b,e,c,k,h,r,f){switch(b.type){case "start-unknown":for(var g=Math.min(.1,1-b.offset_start),n=0;n+.01<=g;n+=.02)a.rect(e+c*(b.offset_start+n),h,c*Math.min(.01,g-n),k,"F");break;case "unknown-end":g=Math.min(b.offset_end,.1);for(n=0;n+.01<=g;n+=.02)a.rect(e+c*(b.offset_end-g+n),h,c*Math.min(.01,g-n),k,"F");break;default:a.rect(e+c*b.offset_start,h,c*(b.offset_end-
b.offset_start),k,"F")}b.type.search(/^start-/)||a.rect(e-.1+c*b.offset_start,r,k,f,"F");-1!=b.type.search(/-end$/)&&a.rect(e+.1+c*b.offset_end-k,r,k,f,"F")}function q(b){var e=Math.floor(b/6E4)%60;return Math.floor(b/36E5)+(10>e?":0":":")+e}var u=d.long_term.activities,w=d.long_term.schedule,z=d.long_term.summary_days,L=d.long_term.summary_asleep,M=d.long_term.sleeps_per_day,N=d.long_term.meds_per_day,B=d.recent.activities,C=d.recent.schedule,O=d.recent.summary_days,P=d.recent.summary_asleep,Q=d.recent.sleeps_per_day,
R=d.recent.meds_per_day,a=d.pdf,S=d.timezone;d=d.software_version;var D={snack:"S",meal:"M",alcohol:"A",chocolate:"C",caffeine:"C","sleep aid":"P",exercise:"X",toilet:"T",noise:"N",alarm:"W"},E={"in bed":"\u00af","out of bed":"\u00ad"};a.text("Sleep Report",105,37,{align:"center"});a.setFontSize(12);a.text("Recent",80,53,{align:"center"});a.text("Long-term",120,53,{align:"center"});a.text("Graph",160,53,{align:"center"});a.text("Date began",20,60);a.text("Total Sleep Time",20,70);a.text("Wake At",
20,80);a.text("Asleep At",20,90);a.text("Day Length",20,100);a.text("Sleeps Per Day",20,110);a.text("Medications Per Day",20,120);a.text("Timezone:",20,135);a.line(42,136,127,136);var F="The numbers above show mean \u00b1 standard deviation, calculated from the digital diary.;Sleeps Per Day and Medications Per Day are calculated based on biological days,;so a 36-hour day with an 8-hour primary sleep and a 4-hour secondary sleep;counts as two sleeps per day.;;Total Sleep Time includes naps, but Wake At and Asleep At do not.;;The black lines in the graph show the 14-day rolling average.;The grey dots in the graph show a single event.".split(";"),
G=["","We would like to thank the Centre of Sleep and Chronobiology, University of Toronto","for the original concept of the Sleep Disorder Patient Chart","originated by Moldofsky/MacFarlane \u00a9 1990",""];a.text(F.concat(G,["Please send feedback to","Software version: f2e34e3/"+d,"Report version: 20210606"]),20,150);a.setTextColor(0,0,255);a.textWithLink("sleepdiary.github.io",67.2,150+4.875*(F.length+G.length)-.1,{url:"https://sleepdiary.github.io"});a.setTextColor(0);a.setFont("Courier");a.text(B[0].id.split("T")[0],
80,60,{align:"center"});a.text(u[0].id.split("T")[0],120,60,{align:"center"});[[P,L,0],[C.wake,w.wake,0],[C.sleep,w.sleep,0],[O,z,0],[Q,M,1],[R,N,1]].forEach(function(b,e){if(b[0]&&b[1]){var c=70+10*e,k=b.pop();b.forEach(function(l,t){t=80+40*t;var T=k?l.mean.toFixed(2):q(l.mean);l=k?l.standard_deviation.toFixed(2):q(l.standard_deviation);a.text(T,t-2,c,{align:"right"});a.setFontSize(10);a.text("\u00b1",t,c-.2,{align:"center"});a.setFontSize(12);a.text(l,t+2,c,{align:"left"})});e=c-5;var h=e+7,r=
1<u.length?40/(u.length-1):0,f=0,g,n=Infinity,v=function(l){for(;f<u.length&&(u[f]||{end:0}).end<=l;)++f;return 140+r*f},x=b[1].durations.filter(function(l){return void 0!==l}).sort(function(l,t){return l-t}),y=(k?x[x.length-1]||1:Math.ceil(Math.max(x[Math.floor(.95*x.length)],864E5)))/7;a.setDrawColor(220);a.line(140,e,140,e+7);a.line(140,e+7,180,e+7);k||a.line(140,h-864E5/y,139,h-864E5/y);a.setDrawColor(0);a.setFillColor(220);b[1].durations.forEach(function(l,t){void 0!==l&&a.circle(v(b[1].timestamps[t]),
h-l/y,.25,"F")});a.setFillColor(0);f=0;b[1].rolling_average.forEach(function(l,t){void 0!==l&&(t=v(b[1].timestamps[t]),l=h-l/y,3.5<Math.abs(g-l)||n<t-7?n=Infinity:(n<t&&a.line(n,g,t,l),n=t),g=l)})}else a.text("(no data)",100,70+10*e-.2,{align:"center"})});a.text(S||"GMT",44,135);a.setDrawColor(0);B.forEach(function(b,e){a.setFont("Helvetica");e%7||(a.addPage(),a.setFontSize(16),a.text("Week "+(e/7+1),105,37,{align:"center"}),a.setFontSize(10),a.text("Date began:",25,47),a.line(45,48,71,48));var c=
61+e%7*30,k=b.id.split("T")[0],h=new Date(k+"T00:00:00.000Z");switch(h.getUTCDay()){case 0:case 6:a.setFont("Helvetica","bold");break;default:a.setFont("Helvetica","normal")}a.text((new Intl.DateTimeFormat(void 0,{weekday:"short",day:"numeric"})).format(h),7.5,c-4);a.setFont("Helvetica","normal");a.setFillColor(234);a.rect(22,c,163,14);a.rect(22,c+7,163,7,"DF");a.setFontSize(10);a.text("pm",22,c-6);a.text("6",22,c-2);h=0;for(var r=1;r<b.segments.length;++r){var f=22+163*r/b.segments.length,g=b.segments[r].hour,
n=b.segments[r].dst_state;a.line(f,c,f,c+14);if(!(r%2))switch(h){case 0:12>g&&(a.text("midnight",f,c-6,{align:"center"}),h=1);break;case 1:a.text("am",f,c-6),h=2;case 2:12<=g&&(a.text("noon",f,c-6),h=0)}switch(n){case "change-forward":a.setFont("ZapfDingbats");a.text("\u00f3",f,c-2,{align:"center"});a.setFont("Helvetica");break;case "change-back":a.setFont("ZapfDingbats");a.text("\u00f3",f+2.5,c-4.5,{align:"center",angle:180});a.setFont("Helvetica");break;default:g%2||a.text(""+(g%12||12),f,c-2)}}a.text("pm",
185,c-6,{align:"right"});a.text("6",185,c-2,{align:"right"});a.setFontSize(7);a.text("ACTIVITIES",21,c+4,{align:"right"});a.text(["SLEEP","TIME"],21,c+10,{align:"right"});a.text("LIGHTS OUT",25,c+18);a.line(40,c+19,56,c+19);a.text("am",57,c+18);a.text("pm",62,c+18);a.text("TOTAL SLEEP TIME",137,c+18);a.line(161,c+19,177,c+19);a.text("hrs",178,c+18);a.setFont("Courier");a.setFontSize(10);e%7||a.text(k,58,47,{align:"center"});a.setFillColor(0);a.setFontSize(16);b.activities.forEach(function(v){D[v.record.status]?
a.text(D[v.record.status],22+163*v.offset_time,c+5,{align:"center"}):"asleep"==v.record.status?p(v,22,163,.5,c+10,c+8,5):E[v.record.status]&&(a.setFont("Symbol"),a.text(E[v.record.status],22+163*v.offset_time,c+13,{align:"center"}),a.setFont("Courier"))});a.setFontSize(10);b.activity_summaries.hasOwnProperty("lights off")&&(e=b.activity_summaries["lights off"][b.activity_summaries["lights off"].hasOwnProperty("last_start")?"last_start":"last_end"],a.text(e.replace(/.*T(..):(..).*/,function(v,x,y){return(parseInt(x,
10)%12||12)+":"+y}),48,c+18,{align:"center"}),-1==e.search(/T(?:0|10|11)/)?a.circle(63.7,c+17.3,2.1):a.circle(58.7,c+17.3,2.1));b=(b.activity_summaries.asleep||{duration:NaN}).duration;isNaN(b)||a.text(b?(b/36E5).toFixed(1):"(none)",169,c+18,{align:"center"})});var A=[];u.forEach(function(b){var e=A[2*b.year+(6>b.month?0:1)]=A[2*b.year+(6>b.month?0:1)]||[];(e[b.month%6]=e[b.month%6]||[])[b.day]=b});A.forEach(function(b){a.addPage("a4","l");b.forEach(function(e,c){var k=3>c?9:111,h=12+c%3*93,r=e.find(function(f){return f});
a.setFont("Helvetica");a.setFontSize(10);a.text("6pm",h,k+4);a.text(r.year+"-"+m(r.month+1),h+41,k+4,{align:"center"});a.text("6pm",h+82,k+4,{align:"right"});a.setFontSize(8);e.forEach(function(f,g){switch((new Date(r.year+"-"+m(r.month+1)+"-"+m(g+1)+"T00:00:00.000Z")).getUTCDay()){case 0:case 6:a.setFont("Helvetica","bold");break;default:a.setFont("Helvetica","normal")}a.text(""+(g+1),h-1,k+7.75+2.75*g,{align:"right"})});a.setFont("Helvetica","normal");a.setFillColor(234);e.forEach(function(f,g){a.rect(h,
k+5+2.75*g,82,2.75,"F");a.setDrawColor(192);for(f=1;4!=f;++f)a.line(h+82*f/4,k+5+2.75*g,h+82*f/4,k+5+2.75*(g+1),"DF");a.setDrawColor(0);a.rect(h,k+5+2.75*g,82,2.75,"D")});a.setFillColor(0);e.forEach(function(f,g){return f.activities.filter(function(n){return"asleep"==n.record.status}).forEach(function(n){return p(n,h,82,.25,k+5+2.75*g+1.25,k+5+2.75*g+.25,2.25)})})})});return{pdf:a,filename:"sleep diary ("+u[u.length-1].id.split("T")[0]+").pdf"}};}).call(this);
//# sourceMappingURL=sleepdiary-report.min.js.map
